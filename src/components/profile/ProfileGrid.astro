---
import type { BrewsItem } from "@/types/brews";
import CustomPieChart from "./CustomPieChart";
import CardWrapper from "./CardWrapper.astro";
import PopularCard from "./PopularCard.astro";
import FriendsCard from "./FriendsCard.astro";
import ProfileCard from "./ProfileCard.astro";
import DevTypeCard from "./DevTypeCard.astro";
import HashtagsCloud from "./HashtagsCloud.astro";
import DescriptionCard from "./DescriptionCard.astro";
import StatCard from "./StatCard.astro";
import TotalPackagesCard from "./TotalPackagesCard.astro";
import BrewCard from "./BrewCard.astro";
import SimilarCard from "./SimilarCard.astro";
import RankingCard from "./RankingCard.astro";

type Props = {
  entry: BrewsItem;
};

const { entry } = Astro.props;

const { personalitySummary } = entry;

const statRandomizer = Math.random() > 0.5;

// TODO: Generate personality summary if null
if (!personalitySummary) {
  return Astro.redirect("/brew/" + entry.id);
}
---

<section
  class="grid p-10 rounded-3xl relative overflow-hidden max-w-[1380px] w-full h-full"
>
  <div class="absolute -inset-[80px] overflow-hidden rounded-xl">
    <video class="absolute w-full h-full" playsinline autoplay muted loop>
      <source src="/gradient-1920.mp4" type="video/mp4" aria-hidden="true" />
      Your browser does not support the video tag.
    </video>
  </div>
  <div
    class="grid backdrop-blur-3xl p-6 rounded-2xl bg-bkg/50 aspect-video"
    data-gridWrapper
  >
    <CustomPieChart data={personalitySummary.developerType} />
    <PopularCard mostPopularPackage={personalitySummary.mostPopularPackage} />
    <FriendsCard friendsWith={personalitySummary.friendsWith} />
    <ProfileCard username={entry.userInfo.username} />
    <DevTypeCard title={personalitySummary.title} />
    <HashtagsCloud hashtags={personalitySummary.hashtags} />
    <DescriptionCard description={personalitySummary.description} />
    <StatCard
      title={statRandomizer
        ? personalitySummary.relevantStat.title
        : personalitySummary.relevantStat.title}
      content={statRandomizer
        ? personalitySummary.relevantStat.content
        : personalitySummary.relevantStat.content}
    />
    <TotalPackagesCard
      totalPackagesUploaded={personalitySummary.totalPackagesUploaded}
    />
    <RankingCard
      totalPackagesUploaded={personalitySummary.totalPackagesUploaded}
      totalPackagesUploadedComparitive={personalitySummary.totalPackagesUploadedComparitive}
    />
    <SimilarCard
      percentileSimilarToType={personalitySummary.percentileSimilarToType}
      title={personalitySummary.title}
    />
    <BrewCard />
  </div>
  <style is:global>
    [data-gridWrapper] {
      grid-template-rows: 1.5fr 20px 1.5fr 20px 3fr 20px 40px 20px 40px 4fr;
      grid-template-columns: 3fr 20px 1fr 20px 4fr 20px 1fr 20px 20px 3fr;
    }

    [data-gridname="pie"] {
      grid-row: 1 / 6;
      grid-column: 1 / 4;
    }

    [data-gridname="top-package"] {
      grid-row: 7 / 8;
      grid-column: 1 / 4;
    }

    [data-gridname="friends"] {
      grid-row: 9 / -1;
      grid-column: 1 / 2;
    }

    [data-gridname="github"] {
      grid-row: 1 / 2;
      grid-column: 5 / 6;
    }

    [data-gridname="type"] {
      grid-row: 3 / 8;
      grid-column: 5 / 6;
    }

    [data-gridname="hashtags"] {
      grid-row: 8 / 10;
      grid-column: 3 / 8;
      place-self: center;
    }
    [data-gridname="desc"] {
      grid-row: 10 / -1;
      grid-column: 3 / 8;
    }
    [data-gridname="stat"] {
      grid-row: 1 / 4;
      grid-column: 7 / -1;
    }
    [data-gridname="totalPackages"] {
      grid-row: 5 / 6;
      grid-column: 7 / 9;
    }
    [data-gridname="ranking"] {
      grid-row: 5 / 6;
      grid-column: 10 / -1;
    }
    [data-gridname="brewfiles"] {
      grid-row: 9 / -1;
      grid-column: 9 / -1;
    }
    [data-gridname="similar"] {
      grid-row: 7 / 8;
      grid-column: 7 / -1;
    }
  </style>
</section>
