---
import Link from "@/components/ui/Link.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { brewfileLinkDictionary } from "@/lib/getBrewfileLink";
import type { Brews } from "@/types/brews";
import { Image } from "astro:assets";

// for PROD
const { id } = Astro.params;
const res = await fetch(`${Astro.url.origin}/api/getBrewfiles.json?id=${id}`);

if (!res.ok) return Astro.redirect("/");
const brews: Brews = await res.json();

const entry = brews.brews[0];
if (!entry) return Astro.redirect("/");
---

<BaseLayout title={entry.id} description={`Brewfiles for ${entry.id}`}>
  <div class="flex justify-between items-center px-20 pt-20">
    <div class="py-2 px-4 bg-accent-bluedark rounded-full">
      {entry.data.length} packages in this Brewfile
    </div>
    <div class="flex gap-2">
      <Link
        href={`https://github.com/${entry.userInfo.username}`}
        variant={"text"}>@{entry.userInfo.username}</Link
      >
      <Link
        href={`https://github.com/${entry.userInfo.username}`}
        variant={"icon"}
        size={"bland"}
        classes="rounded-full hover:opacity-80"
      >
        <Image
          src={`https://github.com/${entry.userInfo.username}.png`}
          alt={entry.userInfo.username}
          width="50"
          height="50"
          class="rounded-full grayscale group-hover:ring-4"
        />
      </Link>
    </div>
  </div>
  <div class="max-w-6xl mx-auto flex flex-wrap items-center justify-center">
    {
      entry.data.map((item, index) => (
        <Link
          variant={"tile"}
          size={"bland"}
          href={
            brewfileLinkDictionary[item.name] ??
            `https://google.com?q=${item.name}+package`
          }
        >
          {item.name.replaceAll('"', "")}
        </Link>
      ))
    }
  </div>
</BaseLayout>
